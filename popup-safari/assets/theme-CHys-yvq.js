import{B as m,e as h,R as P,f as v,b as p,P as R,d as L,F as B,g as I}from"./api-lEPXQ6QH.js";async function S(e){try{return(await chrome.storage.local.get(e))[e]??null}catch{return null}}async function O(e,t,s){const a=Array.isArray(t),o=!0;if(a)try{const r=await chrome.storage.local.get(e);r[e]!==void 0&&await chrome.storage.local.set({[m+e]:r[e]})}catch{}let n;for(let r=1;r<=h;r++)try{if(await chrome.storage.local.set({[e]:t}),o){const c=(await chrome.storage.local.get(e))[e];if(!b(c,t)){if(r<h){await T(P*r);continue}return await A(e,"Verification failed after all retries")}}return a&&setTimeout(async()=>{try{await chrome.storage.local.remove(m+e)}catch{}},5e3),{ok:!0,data:t}}catch(i){if(n=i,i instanceof Error&&i.message.includes("QUOTA_BYTES"))return{ok:!1,error:"Storage quota exceeded. Please delete some data."};r<h&&await T(P*r)}return await A(e,n instanceof Error?n.message:"Unknown error")}async function A(e,t){try{const a=(await chrome.storage.local.get(m+e))[m+e];if(a!==void 0)return await chrome.storage.local.set({[e]:a}),{ok:!1,error:`Write failed: ${t}. Restored from backup.`,recoveredFromBackup:!0}}catch{}return{ok:!1,error:t}}async function C(){return new Promise(e=>{chrome.storage.local.getBytesInUse(null,t=>{const s=v;e({bytesUsed:t,bytesTotal:s,percentUsed:t/s*100})})})}async function H(e=80){return(await C()).percentUsed>=e}const y=new Map;async function d(e,t){const s=y.get(e);s&&await s;let a;const o=new Promise(n=>{a=n});y.set(e,o);try{const n=await S(e),r=await t(n);return await O(e,r)}finally{a(),y.delete(e)}}function T(e){return new Promise(t=>setTimeout(t,e))}function b(e,t){if(e===t)return!0;if(e===null||t===null)return e===t;if(typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(!b(e[s],t[s]))return!1;return!0}if(typeof e=="object"&&typeof t=="object"){const s=e,a=t,o=Object.keys(s),n=Object.keys(a);if(o.length!==n.length)return!1;for(const r of o)if(!Object.prototype.hasOwnProperty.call(a,r)||!b(s[r],a[r]))return!1;return!0}return!1}const f=R,G=25*1e3;async function F(e,t){let s;const a=new Promise(n=>{s=setTimeout(()=>n(null),t)}),o=await Promise.race([e,a]);return s&&clearTimeout(s),o}async function g(){return(await S(f)??[]).slice().sort((t,s)=>s.createdAt-t.createdAt)}async function V(e){const t=await g(),a=t.filter(i=>i.source===e).filter(i=>!i.packName),o=new Map;for(const i of t)if(i.packName){const c=o.get(i.packName)||[];c.push(i),o.set(i.packName,c)}const n=[],r=e==="chatgpt"?"ChatGPT":e==="claude"?"Claude":e==="gemini"?"Gemini":e==="perplexity"?"Perplexity":e==="grok"?"Grok":e==="deepseek"?"DeepSeek":"Kimi";n.push({name:e,displayName:`${r} Prompts`,prompts:a});for(const[i,c]of o)n.push({name:i,displayName:`"${i}" Prompts`,prompts:c});return n}function D(e){const t=e.split(".");if(t.length!==3)return null;try{const s=t[1].replace(/-/g,"+").replace(/_/g,"/"),a=s+"=".repeat((4-s.length%4)%4),o=atob(a),n=JSON.parse(o);if(typeof n.exp=="number")return n.exp*1e3}catch{}return null}async function U(){const e=await I();if(!e?.accessToken)return null;const t=D(e.accessToken);return t&&t<=Date.now()||e.expiresAt<=Date.now()?null:e}async function N(){const e=await U();if(e?.entitlements?.promptLimit)return e.entitlements.promptLimit;if(e?.tier==="paid")return L;const t=await j();return typeof t=="number"?t:B}async function j(){return chrome?.runtime?.sendMessage?new Promise(e=>{chrome.runtime.sendMessage({type:"PP_GET_PROMPT_LIMIT"},t=>{if(chrome.runtime.lastError){e(null);return}const s=t?.limit;e(typeof s=="number"?s:null)})}):null}async function x(e,t){try{await d(f,a=>{const o=a??[],n=o.findIndex(i=>i.id===e);if(n===-1)return o;const r=[...o];return r[n]={...r[n],classifying:!0,classifyingAt:Date.now()},r});const s=await F(p.classifyPrompt(t),G);if(!s){await d(f,a=>{const o=a??[],n=o.findIndex(u=>u.id===e);if(n===-1)return o;const r=[...o],{classifyingAt:i,...c}=r[n];return r[n]={...c,classifying:!1},r}),console.warn(`[PromptPack] Classification timed out for prompt ${e}`);return}s.success&&s.header?await d(f,a=>{const o=a??[],n=o.findIndex(u=>u.id===e);if(n===-1)return o;const r=[...o],{classifyingAt:i,...c}=r[n];return r[n]={...c,header:s.header,headerGeneratedAt:Date.now(),classifying:!1},r}):(await d(f,a=>{const o=a??[],n=o.findIndex(u=>u.id===e);if(n===-1)return o;const r=[...o],{classifyingAt:i,...c}=r[n];return r[n]={...c,classifying:!1},r}),console.warn(`[PromptPack] Failed to classify prompt ${e}:`,s.error))}catch(s){await d(f,a=>{const o=a??[],n=o.findIndex(u=>u.id===e);if(n===-1)return o;const r=[...o],{classifyingAt:i,...c}=r[n];return r[n]={...c,classifying:!1},r}),console.error(`[PromptPack] Classification error for prompt ${e}:`,s)}}async function J(e){const t=e.text.trim();if(!t)return{ok:!1,reason:"empty"};const s=await N(),a=await d(f,r=>{const i=r??[];if(!i.some(l=>l.text===t&&l.source===e.source)&&i.length>=s)return i;const u=i.filter(l=>!(l.text===t&&l.source===e.source));return[{id:crypto.randomUUID(),text:t,source:e.source,url:e.url,createdAt:Date.now()},...u].slice(0,s)});if(!a.ok)return{ok:!1,reason:"storage_error",error:a.error};const o=await g();if(o.length>=s&&!o.some(r=>r.text===t&&r.source===e.source))return{ok:!1,reason:"limit",max:s};if(await p.verifyAuthSession()){const i=a.data.find(c=>c.text===t&&c.source===e.source);i?x(i.id,t).catch(c=>{console.error("[PromptPack] Classification failed:",c)}):console.warn("[PromptPack] Could not find saved prompt to classify. Text:",t.substring(0,50))}return{ok:!0,count:a.data.length,max:s}}async function X(e){const t=e?.staleMs,s=e?.max,a=e?.perSource??!0;if(!await p.verifyAuthSession())return 0;const n=await g(),r=Date.now(),i=n.filter(u=>!u.packName&&u.header==null&&u.classifying===!0&&(!u.classifyingAt||r-u.classifyingAt>t));if(!i.length)return 0;let c;if(a){const u=["chatgpt","claude","gemini","perplexity","grok","deepseek","kimi"];c=[];for(const l of u){const M=i.filter(_=>_.source===l).slice(0,s);c.push(...M)}}else c=i.slice(0,s);return c.forEach(u=>{x(u.id,u.text)}),c.length}async function Q(e){const t=e?.max,s=e?.perSource??!0;if(!await p.verifyAuthSession())return 0;const n=(await g()).filter(i=>!i.packName&&i.header==null);if(!n.length)return 0;let r;if(s){const i=["chatgpt","claude","gemini","perplexity","grok","deepseek","kimi"];r=[];for(const c of i){const u=n.filter(l=>l.source===c).slice(0,t);r.push(...u)}}else r=n.slice(0,t);return r.forEach(i=>{x(i.id,i.text)}),r.length}async function W(e){const t=await d(f,s=>(s??[]).filter(a=>a.id!==e));return t.ok?{ok:!0,count:t.data.length}:{ok:!1,error:t.error}}async function z(e){const t=await d(f,s=>(s??[]).filter(a=>a.source!==e));return t.ok?{ok:!0,count:t.data.length}:{ok:!1,error:t.error}}async function Z(e,t){const s=[],a=Date.now();for(let n=0;n<e.length;n++){const r=e[n];s.push({id:crypto.randomUUID(),text:r.text.trim(),source:r.source,url:r.url,createdAt:a+n,packName:t,..."header"in r&&r.header&&{header:r.header},..."headerGeneratedAt"in r&&r.headerGeneratedAt&&{headerGeneratedAt:r.headerGeneratedAt}})}const o=await d(f,n=>[...s,...n??[]]);return o.ok?{ok:!0,imported:s}:{ok:!1,imported:[],error:o.error}}async function ee(e){const t=new Set(e),s=await d(f,a=>(a??[]).filter(o=>!t.has(o.id)));return s.ok?{ok:!0}:{ok:!1,error:s.error}}async function te(e,t){let s=[];const a=await d(f,o=>{const n=o??[];return s=n.filter(r=>r.packName===e&&r.source===t),n.filter(r=>!(r.packName===e&&r.source===t))});return a.ok?{ok:!0,deleted:s}:{ok:!1,deleted:[],error:a.error}}async function re(e){const t=await d(f,s=>[...e,...s??[]]);return t.ok?{ok:!0}:{ok:!1,error:t.error}}async function se(e,t){const s=await d(f,a=>{const o=a??[],n=o.findIndex(i=>i.id===e);if(n===-1)return o;const r=[...o];return r[n]={...r[n],header:t,headerGeneratedAt:Date.now()},r});return s.ok?{ok:!0}:{ok:!1,error:s.error}}async function ne(e,t){const s=t.trim();if(!s)return{ok:!1,error:"empty"};let a=!1;const o=await d(f,n=>{const r=n??[],i=r.findIndex(u=>u.id===e);if(i===-1)return r;a=!0;const c=[...r];return c[i]={...c[i],text:s},c});return o.ok?a?{ok:!0}:{ok:!1,error:"not_found"}:{ok:!1,error:o.error}}const k="promptpack_theme";function w(e){return Math.max(0,Math.min(1,e))}function q(e){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return t?{r:Number(t[1]),g:Number(t[2]),b:Number(t[3])}:null}function Y(e){const t=q(e);if(!t)return null;const s=w(t.r/255),a=w(t.g/255),o=w(t.b/255);return .2126*s+.7152*a+.0722*o}function E(){return window.matchMedia?.("(prefers-color-scheme: dark)").matches?"dark":"light"}function K(e=document){const t=e.documentElement,s=e.body;if(t.classList.contains("dark")||s?.classList.contains("dark"))return"dark";if(t.classList.contains("light")||s?.classList.contains("light"))return"light";const a=t.getAttribute("data-theme")||s?.getAttribute("data-theme");if(a==="dark")return"dark";if(a==="light")return"light";const o=t&&getComputedStyle(t).backgroundColor,n=s&&getComputedStyle(s).backgroundColor;let r=n||o||"";r.includes("rgba")&&r.includes(", 0)")&&(r=(r===n?o:n)||r);const i=Y(r);return i==null?E():i>.6?"light":"dark"}function oe(e={}){const{onChange:t,persistToStorage:s=!0}=e;let a=null,o=!1;const n=async()=>{const l=K(document);l!==a&&(a=l,s&&await chrome.storage.local.set({[k]:l}),t?.(l))},r=()=>{o||(o=!0,requestAnimationFrame(()=>{o=!1,n()}))};n();const i=new MutationObserver(r);i.observe(document.documentElement,{attributes:!0,attributeFilter:["class","style"]}),document.body&&i.observe(document.body,{attributes:!0,attributeFilter:["class","style"]});const c=window.matchMedia?.("(prefers-color-scheme: dark)"),u=()=>r();return c?.addEventListener?.("change",u),function(){i.disconnect(),c?.removeEventListener?.("change",u)}}async function ae(){const s=(await chrome.storage.local.get(k))[k]??E();document.documentElement.dataset.theme=s}const ie={light:{text:"rgba(255, 255, 255, 0.95)",border:"rgba(0, 0, 0, 0.14)",shadow:"0 10px 28px rgba(0, 0, 0, 0.35)",buttonBg:"rgba(0, 0, 0, 0.95)",font:"'Open Sans', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial"},dark:{text:"rgba(17, 24, 39, 0.95)",border:"rgba(0, 0, 0, 0.12)",shadow:"0 10px 28px rgba(0, 0, 0, 0.12)",buttonBg:"rgba(255, 255, 255, 0.92)",font:"'Open Sans', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial"}},ce={light:{text:"rgba(0, 0, 0, 0.95)",shadow:"0 2px 8px rgba(0, 0, 0, 0.08)",accent:"#C15F3C",font:"'Tiempos Text Regular', 'Tiempos Text', ui-serif, Georgia, serif"},dark:{text:"rgba(255, 255, 255, 0.95)",shadow:"0 2px 8px rgba(0, 0, 0, 0.3)",accent:"#C15F3C",font:"'Tiempos Text Regular', 'Tiempos Text', ui-serif, Georgia, serif"}},ue={light:{text:"rgba(0, 0, 0, 0.87)",border:"rgba(0, 0, 0, 0.12)",shadow:"0 1px 3px rgba(0, 0, 0, 0.12)",buttonBg:"rgb(245, 245, 245)",font:"Google Sans, Roboto, ui-sans-serif, system-ui, -apple-system, Arial"},dark:{text:"rgba(255, 255, 255, 0.87)",border:"rgba(255, 255, 255, 0.12)",shadow:"0 1px 3px rgba(0, 0, 0, 0.5)",buttonBg:"rgb(32, 33, 36)",font:"Google Sans, Roboto, ui-sans-serif, system-ui, -apple-system, Arial"}},le={bg:"#1a1a2e",text:"#e0e0e0",border:"rgba(139, 92, 246, 0.3)",shadow:"0 4px 12px rgba(0, 0, 0, 0.4)",accent:"#8b5cf6",secondary:"rgba(224, 224, 224, 0.6)",inputBg:"rgba(255, 255, 255, 0.1)",font:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif"};export{k as T,ae as a,X as b,Q as c,W as d,z as e,te as f,E as g,se as h,re as i,H as j,Z as k,g as l,K as m,J as n,V as o,ie as p,ce as q,ee as r,oe as s,ue as t,ne as u,le as v};
